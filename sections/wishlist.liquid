{% comment %} 
** Add code in card-product.liquid **

<a href="/pages/wishlist" class="wishlist-icon" data-product-handle="{{ card_product.handle }}">
   <span class="svg-wrapper"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></span>       
</a>

** Add code in header.liquid **
 <a href="/pages/wishlist" class="header-wishlist-icon">
   <span class="svg-wrapper"> {{'icon-heart.svg' | inline_asset_content }}</span>
 <span class="header-wishlist-count count" totalwishlistitems="" >0</span>        
</a>
{% endcomment %}



{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
.wishlist-page .heading {
    padding: 10px 0 30px 0px;
    margin: 0;
    color: #000;
}
  .wishlist-page {
    max-width: 1280px;
    width: 100%;
    margin: 0 auto;
    padding: 0 15px;
}
#wishlist-container {
    display: flex;
    flex-wrap:wrap;
    width: 100%;
    gap: 25px;
    padding:0;
    margin:0;
}
.wishlist-item {
    list-style: none;
    width: calc(25% - 25px * 2/3);
    border-radius: 6px;
    padding: 18px 18px 0 18px;
    box-shadow: 0px 4px 24px 0px rgba(0, 0, 0, 0.1);
}
 .wishlist-item .wishlist-item-inner img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.main-wishlist-page{
  background:#eff0f5;
}
  .original-price {
    text-decoration: line-through;
}
.product-details h3, .price {
    font-size: 14px;
    color: #000000BF;
    margin: 10px 0;
}
.addToCart_button form input{
    background-color: #085552;
    border: 1px solid #085552;
    color: white;
    width: 100%;
    padding: 10px 20px;
    font-size: 16px;
    line-height: 1;
    transition: all 0.2s ease-in-out;
    border-radius: 6px;
    font-family: var(--font-body-family);
    cursor: pointer;
    margin-bottom: 15px;
    cursor: pointer;
    opacity: 1;
}
  .addToCart_button form input:hover {
    opacity: 0.8;
}
{%- endstyle -%}

<!-- wishlist page -->
<div class="main-wishlist-page section-{{ section.id }}-padding">
<div class="wishlist-page">
  <h3 class="heading h3">{{ section.settings.heading }}</h3>

<ul id="wishlist-container">
  
</ul>

</div>
</div>

<!-- add js in custom.js file -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
  const wishlistButtons = document.querySelectorAll('.wishlist-icon');
  const wishlistCount = document.querySelector('.header-wishlist-count');

    let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
     updateWishlistCount();
    wishlistButtons.forEach(button => {
        const productHandle = button.dataset.productHandle;
      
        const isInWishlist = wishlist.some(item => item.handle === productHandle);
        if (isInWishlist) {
            button.classList.add('added');
        }

        button.addEventListener('click', function() {
           event.preventDefault();
            fetch(`/products/${productHandle}.js`)
                .then(response => response.json())
                .then(product => {
                    const productData = {
                        handle: product.handle,
                        title: product.title,
                        image: product.images[0],
                        price: (product.price / 100).toFixed(2),
                        productId: product.variants[0].id 
                    };

                    const productIndex = wishlist.findIndex(item => item.handle === productData.handle);

                    if (productIndex === -1) {
                        wishlist.push(productData);
                        this.classList.add('added');
                        document.querySelector('.remove-popup').classList.remove('open');
                        document.querySelector('.add-popup').classList.add('open');
                        setTimeout(function() {
                            document.querySelector('.add-popup').classList.remove('open');
                        }, 2000);
                    } else {
                        wishlist.splice(productIndex, 1);
                        this.classList.remove('added');
                       document.querySelector('.add-popup').classList.remove('open');
                       document.querySelector('.remove-popup').classList.add('open');
                        setTimeout(function() {
                             document.querySelector('.remove-popup').classList.remove('open');
                        }, 2000);
                    }

                    localStorage.setItem('wishlist', JSON.stringify(wishlist));
                  updateWishlistCount();
                })
                .catch(error => console.error('Error fetching product data:', error));
        });
    });

    function updateWishlistCount() {
        const totalWishlistItems = wishlist.length;
        wishlistCount.textContent = totalWishlistItems;
        wishlistCount.setAttribute('totalwishlistitems', totalWishlistItems);
    }
});

document.addEventListener('DOMContentLoaded', function () {
 const wishlistContainer = document.getElementById('wishlist-container');

    let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
    if (wishlist.length > 0 && wishlistContainer) {
        wishlist.forEach(product => {
            const productItem = document.createElement('li');
            productItem.classList.add('wishlist-item');
            productItem.innerHTML = `
                <div class="wishlist-item-inner">
                    <img src="${product.image}" alt="${product.title}" width="">
                    <div class="product-details">
                        <h3>${product.title}</h3>
                        <p class="price">
                            ${product.comparePrice ? `<span class="original-price">$${product.comparePrice}</span>` : ''}
                            <span class="current-price">$${product.price}</span>
                        </p>
                    </div>
                    
                <div class="addToCart_button">
                  <form method="post" action="/cart/add">
                    <input type="hidden" name="id" value="${product.productId}" />
                    <input min="1" type="hidden" id="quantity" name="quantity" value="1"/>
                    <input type="submit" value="Move To Cart" class="btn" />
                  </form>
                  </div>  
                </div>
            `;
            wishlistContainer.appendChild(productItem);
        });
    } else {
        wishlistContainer.innerHTML = '<p>Your wishlist is empty.</p>';
    }
});

</script>

{% schema %}
  {
    "name": "Wishlist",
      "disabled_on": {
    "groups": ["header", "footer"]
  },
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 20
    }
    ],
    "presets": [
      {
        "name": "Wishlist"
      }
    ]
  }
{% endschema %}
